<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script type="text/javascript" src="iopin.js"></script>
<script type="text/javascript" src="gauge.js"></script>
<title>iopin</title>
</head>

<body>
	
<form name="js">
	<h2>micro:bit BLE</h2>
	<input type="button" value="接続" onclick="connect();"/>   <input type="button" value="切断" onclick="disconnect();" />
	
	<h2>P0 出力</h2>
	<input type="button" value="ON"  onclick="setPinValue(0x00, 0x01);"/> P0 = 1 
	<input type="button" value="OFF" onclick="setPinValue(0x00, 0x00);"/> P0 = 0

	<h2> マイクロビット テスター</h2>
	Pin = <input type="text" name="p" value="" />
	value = <input type="text" name="v" value="" />
	P2 値 =<input type="text" name="x" value="" />

</form>
<canvas id="foo" width="380" height="150"></canvas>

<script>
	window.onerror = function (msg, file, line, column, err) {
		alert(msg + file + ':' + line);
	};

(window.onload = function() {
	var opts = {
		angle: 0.15, // The span of the gauge arc
		lineWidth: 0.44, // The line thickness
		radiusScale: 1, // Relative radius
		pointer: {
			length: 0.6, // // Relative to gauge radius
			strokeWidth: 0.035, // The thickness
			color: '#000000' // Fill color
		},
		limitMax: false,		 // If false, max value increases automatically if value > maxValue
		limitMin: false,		 // If true, the min value of the gauge will be fixed
		colorStart: '#6FADCF',	 // Colors
		colorStop: '#8FC0DA',		// just experiment with them
		strokeColor: '#E0E0E0',	// to see which ones work best for you
		generateGradient: true,
		highDpiSupport: true,		 // High resolution support

	};
	var target = document.getElementById('foo'); // your canvas element
	var gauge = new Gauge(target).setOptions(opts); // create sexy gauge!
	gauge.maxValue = 350; // set max gauge value
	gauge.setMinValue(0);	// Prefer setter over gauge.minValue = 0
	gauge.animationSpeed = 128; // set animation speed (32 is default value)

	// 973 243 2.82 v
	// 500 126 1.51 v
	registerCallback((pin, value) =>{
		document.js.p.value = pin;
		document.js.v.value = value;
		let value2 = Math.round(value * 4 * 0.03) * 10
		document.js.x.value = value2 / 100;
		gauge.set(value2); // set actual value
	});
})();
	
</script>
</body>
</html>
